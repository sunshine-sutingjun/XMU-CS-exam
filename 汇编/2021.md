# 2022期末试卷答案

## 二、

```asm
data segment
test1 db 'The food monkeys like:$banana'
test2 db 'The food pandas like :$bamboo'
test3 db 'The food magpies like:$cherry' 
ans db 7, ?, 7 dup(?)
wro db 0dh, 0ah, 'Wrong!', 0dh, 0ah, 24h
rgh db 0dh, 0ah, 'Right!', 0dh, 0ah, 24h
data ends

code segment
main proc far
assume cs:code, ds:data, es:data
start:
 ;① 这里需要填入初始化DS寄存器的指令
push ds
sub ax, ax
push ax
mov ax, data
mov ds, ax
mov es,ax;②  这里需要填入开始循环的指令
mov cx, 3
lea dx, test1
exm: mov ah, 09h
int 21h
push dx ;③ 这里需要填入读取用户输入的指令
mov si, dx
lea dx, ans
mov ah, 0ah
int 21h
push cx; ④这里需要填入比较字符串的指令
mov cx, 6
mov di,dx; ⑤这里需要填入设置SI和DI寄存器的指令（wn：这里应该是dx+2？）
mov si,23;(真的不会 ⑥这里需要填入设置CX寄存器的指令（wn：这里应该是add si,24？）
cld; ⑦这里需要填入字符串比较指令
repnz cmpsb
jnz wrong
lea dx, rgh
mov ah, 09h
int 21h
jmp next; ⑧ 这里需要填入跳过错误信息输出的指令
wrong: lea dx, wro
mov ah, 09h
int 21h
next:
pop cx; ⑨这里需要填入返回循环的指令
pop dx;⑩ 这里需要填入更新DX寄存器的指令，以便下一次循环
add dx, 30
loop exm
ret
main endp
code ends
end start
```
## 三、
1、
```asm
mov ax,a
cwd
mov cx,2022
idiv cx;除完只剩ax

cwd
mov cx,ax
mov bx,dx

mov ax,b
imul c;存储在dx,ax中
add cx,ax
adc bx,dx
mov ax,d
mov si,2
imul si
add cx,ax
adc bx,0

```
存储在cx,bx中
2、
```asm
data segment
    tablenum db 10 dup(20 dup(?))
    tablepos db 10 dup(?)
    mess1 db '个位是1的：'
    mess2 db '个位是2的：'
    mess3 db '个位是3的：'
data ends
code segment
main proc far
assume cs:code,ds:data
start:
    push ds
    sub ax,ax
    push ax
    mov ax,data
    mov ds,ax

    mov ax,1
    mov cx,100
    push cx
outloop:
    call isprime
    cmp dx,1
    jnz nextloop
    mov bx,1
    push ax
    div bx
    ;ax储存个位数
    dec ax
    lea bx,tablepos
    mov di,ax
    add di,bx
    mov si,[di]
    mov bx,20
    mul bx
    add si,ax
    pop ax
    mov [si],ax
    inc si
    mov [di],si
nextloop:
    inc ax
    pop cx
    loop outloop

    mov si,0
    mov cx,10
    push cx
    mov di,0
    lea dx,mess1
    mov ah,09h
output:
    int 21h
    lea bx,tablepos
    mov cx,[ bx+di]

    push si
    push di

    outputloop:
    mov bx,[si]
    call dec_oct
    inc si
    loop outputloop

    pop di
    pop si
    pop cx
    add si,20
    add di,6
    loop output
    ret
main endp
dec_oct proc near
    push cx
    push bx
    mov cx,10d
    call divdec
    mov cx,1d
    call divdec
    pop bx
    pop cx
    ret
dec_oct endp
divdec proc near
    div cx
    mov bx,dx
    mov dl,al
    add dl,30h
    mov ah,02h
    int 21h
    ret
divdec endp
isprime proc near
loopprime:
    mov bx,2
    push ax
    div bx
    pop ax
    test dx,dx
    jz notprime
next:
    inc bx
    cmp bx,ax
    jl loopprime
    mov dx,1
    jmp exit
notprime:
    mov dx,0
exit:
    ret
isprime endp
code ends
end start
```
2、
```asm
dseg	segment
	count	dw	1
	count2	dw	1
	flag	dw	0

	mess0	db	'Are you ready?',10,13,'$'
	mess1	db	'1',10,13,'$'
	mess2	db	'2',10,13,'$'
	mess3	db	'3',10,13,'$'
	mess4	db	'Go!',10,13,'$'
	mess5	db	'must be N/Y',10,13,'$'
dseg	ends
cseg	segment
	assume cs:cseg,ds:dseg,es:dseg
main	proc	far
start:
	push	ds
	sub		ax,ax
	push	ax

	mov		ax,dseg
	mov		ds,ax
	mov		es,ax
begin:
	mov		al,1ch
	mov		ah,35h
	int		21h
	push	es
	push	bx

	push	ds
	mov		ax,seg ring
	mov		ds,ax
	mov		dx,offset ring
	mov		al,1ch
	mov		ah,25h
	int		21h
	pop		ds

	in		al,21h
	mov		al,11111100b
	out		21h,al

	sti

	mov		si,2000h
loop1:
	mov		di,3000h
loop2:
	dec		di
	jnz		loop2
	dec		si
	jnz		loop1

	pop		dx
	pop		ds
	mov		al,1ch
	mov		ah,25h
	int		21h

	ret
main	endp
ring	proc	near
	push	ds
	mov		ax,dseg
	mov		ds,ax

	sti
	in		al,20h
	or		al,20h
	out		20h,al

	cmp		flag,0
	jnz		next3

	dec		count
	jz		next22
	jmp		exit
next22:
	lea		dx,mess0
	mov		ah,09h
	int		21h
next0:
	mov		ah,01h
	int		21h

	cmp		al,'N'
	jnz		next1
	jmp		exit11
next1:
	cmp		al,'Y'
	jz		next2
	lea		dx,mess5
	mov		ah,09h
	int		21h
	jmp		next0
next2:
	mov		ax,3
	mov		flag,ax
	jmp		exit
next3:
	dec		count2
	jnz		exit

	cmp		flag,3
	jnz		next4
	lea		dx,mess3
	mov		ah,09h
	int		21h

	mov		ax,18
	mov		count2,ax

	mov		ax,2
	mov		flag,ax

	jmp		exit
next4:
	cmp		flag,2
	jnz		next5

	lea		dx,mess2
	mov		ah,09h
	int		21h

	mov		ax,18
	mov		count2,ax

	mov		ax,1
	mov		flag,ax

	jmp		exit
next5:
	cmp		flag,1
	jnz		next6

	lea		dx,mess1
	mov		ah,09h
	int		21h

	mov		ax,18
	mov		count2,ax

	mov		ax,4
	mov		flag,ax

	jmp		exit
next6:
	cmp		flag,4
	jnz		exit

	lea		dx,mess4
	mov		ah,09h
	int		21h

	mov		ax,18
	mov		count2,ax

	mov		ax,0
	mov		flag,ax

exit11:
	mov		ax,180
	mov		count,ax
exit:
	cli
	pop		ds
	iret
ring	endp
cseg	ends
	end		start
 ```
