
操作系统实验考试 2018.6.20

在目录“/home/cs15/exam”下有本文件，可复制到你自己的主目录后，用
“cat testpaper”命令打开查看，或下载testpaper.txt到本地打开查看。该目录还有
程序文件“threadtest.cc”，“myproduce.h”和“myproduce.cc”。其中的
“threadtest.cc”文件应替换掉nachos项目中原有的同名文件，“myproduce.h”和
“myproduce.cc”为新增文件，另有原生的nachos代码压缩包备用。

程序 myproduce.cc 实现一个公用缓存区的生产者消费者模型，描述如下：

1、公用缓冲区是用myproduce.cc中所声明的整型动态数组 pbuf 所实现。
2、函数Initialize()为数组pbuf分配空间，并初始化3个同步所需的信号量。
2、函数MultiProducer(which)按照函数参数which的值和函数内语句定义的规则向
   pbuf中按序插入3个整数，例如，参数which为 1 的该函数将插入 1、4、7
   三个整数。
4、函数FinalConsume()在pbuf中插入9个整数后被唤醒，然后按照插入的相反顺序
   打印并删除全部9个数据。
5、函数ThreadTest()基于以上函数创建三个生产者线程和一个消费者线程，自己
   负责调用Initialize()函数。
6、应假设以上线程可能在任何语句之后发生线程间切换。

问题：
    我们期望的输出结果是 9 8 7 6 5 4 3 2 1。然而， 
    代码文件myproduce.cc中缺少若干语句，因此程序无法正确运行。本次考试的
    内容是，向该代码文件中填加适当语句，并将其编译到nachos项目中，使程序
    按上述规则正确执行直到结束。

要求：
1、 修改代码时只能在英文注释指定的位置添加语句，不能删除或注释掉现有的
    语句，不允许增加新的函数。
2、 在你的起始目录下创建目录“osexam”(不含引号，全部小写)。将结果，
    即nachos-3.4子目录code下的文件Makefile.common，及其子目录threads下的
    文件Makefile，myproduce.cc和nachos可执行文件，拷贝至目录osexam中。
    目录osexam中不要包含除了上述文件外的其他文件和目录。
3、 开卷考试，但是不能互相讨论、抄袭，绝对禁止使用手机以及即时通讯工具。

！！！请严格按上述要求完成考试，否则酌情扣分，直至没有实验成绩！！！

建议：
    为了避免以前实验代码的干扰，可以重新安装一个新的Nachos系统，并在此
    系统内调试程序。为了防止新系统覆盖原来的实验代码，可先将原系统的目录
    更名或备份于其他目录。    