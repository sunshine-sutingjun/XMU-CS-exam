# 期末试卷答案

[toc]

## 2008A

### 2008A-1运行结果题

1）
堆栈段使用情况

<1>
|   | 
|---|
|   |
| 0 |  
| ds|  
|   |

<2>
|   | 
|---|
|   |
| IP|
| CS|
| 0 |  
| ds|  
|   |  

<3>
|   | 
|---|
|   |
| IP|
| CS|
| 0 |  
| ds|  
|   |   

<4>
|   | 
|---|
|   |
| IP|
| IP|
| CS|
| 0 |  
| ds|  
|   |  

2）
程序功能

输出三个数最大的

3）运行结果

5555

### 2008A-2填空题
```
mov es,ax
mov ah,01h
mov cl,3
lea di,str1[bx]
mov cx,8
repne scasb
pop bx
mov ah,02h
add dl,30h
end start
```
```
data segment
    str1 db 'happy   '
    str2 db 'Love    '
    str3 db 'Marriage'
    str4 db 'hate    '
data ends
code segment
assume cs:code,ds:data,es:data
main proc far
start:
    push ds
    sub ax,ax
    push ax
    mov ax,data
    mov ds,ax
    mov es,ax
    mov ah,01h
    int 21h
    mov bx,0
    mov dl,0
search:
    mov cl,3
    push bx
    shl bx,cl
    lea di,str1[bx]
    mov cx,8
    cld
    repne scasb
    jne next
    inc dl
next:
    pop bx
    inc bx
    cmp bx,4
    jnz search
    mov ah,02h
    add dl,30h
    int 21h
    ret
main endp
code ends
end main
```
### 2008A-3编程计算题

数据段中定义了4个带符号字数据：A、B、C、D，编写指令计算出A+（B*10+C）/D的结果，并说明结果的存放情况。

```asm
datarea segment
        a       dw 100
        b       dw 200
        cc      dw 300        ;在真实的汇编编程中，c是一个关键字，会报错。但是考试还得写成“C”
        d       dw 23
datarea ends
prognam segment
main proc far
                assume cs:prognam,ds:datarea
        start:  
                push   ds
                sub    ax,ax
                push   ax
                mov    ax,datarea
                mov    ds,ax
            
        ;A+(B*10+C)/D
        ;考试从这儿开始写
                mov    ax,b
                mov    bx,10
                imul   bx
                mov    cx,dx
                mov    bx,ax
                mov    ax,cc
                cwd
                add    ax,bx
                adc    dx,cx
                idiv   d
                add    ax,a
        ;考试从这儿结束
                ret
main endp
prognam ends
    end start
```

结果存在ax中

### 2008A-4编程循环题

已知数组A包含15个互不相等的整数，数组B包含20个互不相等的整数。试编制一程序，统计既在A中出现又在B中出现的元素的个数，并以10进制显示出来。

```asm
;稳妥版
datarea segment
    a       db 3, 6, 9, 12, 15, 18, 21, 24, 27, 30, 33, 36, 39, 42, 45
    b       db 2, 4, 6, 8, 10, 12, 14, 16, 18, 20, 22, 24, 26, 28, 30, 32, 34, 36, 38, 40
    a_count db 15
    b_count db 20
    ;res:[6, 12, 18, 24, 30, 36]
datarea ends
prognam segment
main proc far
              assume cs:prognam,ds:datarea
    start:    
              push   ds
              sub    ax,ax
              push   ax
              mov    ax,datarea
              mov    ds,ax
            
              mov    ax,0                     ;count of same numbers
              mov    si,0                     ;a[si]
    loop1:    
              mov    di,0
    loop2:    
              mov    bl,a[si]
              cmp    bl,b[di]
              jne    not_equal
              inc    ax
    not_equal:
              inc    di
              cmp    di,20
              jl     loop2
              inc    si
              cmp    si,15
              jl     loop1
              call   bin2dec
              ret
main endp
bin2dec proc
    ;ax/src=al...ah
              mov    cx,0
    loop3:    
              mov    bl,10
              div    bl
              push   ax
              xor    ah,ah
              inc    cx
              cmp    al,0
              jg     loop3
    putchar:  
              pop    dx
              mov    dl,dh
              add    dl,30h
              mov    ah,2
              int    21h
              loop   putchar
              ret
bin2dec endp
prognam ends
end start
```

### 2008A-5编程中断题
```
data segment
    count dw 1
    mes db 'busy',13,10,'$'
data ends
code segment
main proc far
assume cs:code, ds:data
start:
    push ds
    sub ax,ax
    push ax
    mov ax,data
    mov ds,ax
    mov es,ax

    mov al,1c
    mov ah,35h
    int 21h
    push es
    push bx

    push ds 

    mov dx,offset check
    mov ax,seg check
    mov ds,ax
    mov al,1ch
    mov ah,25h
    int 21h

    pop ds
    ;打开定时器
    in al,21h
    and al,11111110b
    out 21h,al
    sti

    mov di,20000
delay:
    mov si,30000
delay1:
    dec si
    jnz delay1
    dec di 
    jnz delay

    cli
    pop dx
    pop ds
    mov al,1ch
    mov ah,25h
    int 21h

    ret
main endp
check proc near
    push ax
    push dx
    push ds

    mov ax,data
    mov ds,ax
    sti
    dec count 
    jnz exit

    mov dx,397h
    in al,dx
    test al,10000000b
    jnz exit2
    call output
exit2:
    mov count,18
exit:
    cli
    pop ds
    pop dx
    pop ax
    iret
check endp
output proc near
    lea dx,mes
    mov ah,09h
    int 21h
    ret
output endp
code ends
end start
```
## 2023

1，2题代码如下：

```asm
DATA SEGMENT
    MSG     DB 'WHICH CITY?',13,10,'$'
    CITYIN  DB 10,?,10 DUP (?)
    CITYOUT DB 13,'UMT+0',?,32 DUP (?),13,10,'$'
    CITYTAB DB 'LONDON, UNITED KINGDOM'
            DB 'BERLIN, GERMANY'
            DB 'ATHENS, GREECE'
            DB 'MOSCOW, RUSSIA'
            DB 'DUBAI, UNITED ARAB EMIRATES'
            DB 'ISLAMABAD, PAKISTAN'
            DB 'ALMATY, KAZAKHSTAN'
            DB 'BANGKOK, THAILAND'
            DB 'BEIJING, CHINA'
            DB 'I DO NOT KNOW :('
DATA ENDS

CODE SEGMENT
MAIN PROC FAR
           ASSUME CS:CODE, DS:DATA, ES:DATA
    START: PUSH   DS                           ;❀
           SUB    AX,AX
           PUSH   AX
           MOV    AX,DATA
           MOV    DS,AX
    ;填空①
           CALL   GETT                         ;甲
           PUSH   AX
           CALL   GETL
    ;填空②
           CALL   NOW
           RET
MAIN ENDP

GETT PROC
           MOV    AL, 4
           OUT    70H,AL
           IN     AL, 71H
           MOV    AH, AL
           MOV    AL, 2
           OUT    70H, AL
           IN     AL, 71H
           RET
GETT ENDP

GETL PROC
           LEA    DX, MSG
           MOV    AH,09H
           INT    21H
    ;填空③
           MOV    AH,0AH
           INT    21H
    
           MOV    BX,0
           LEA    DI,CITYTAB

    SRCH:  
    ;填空④
    ;填空⑤
           SUB    CH,CH
           PUSH   DI
           REPE   CMPSB
    ;填空⑥
           JE     FOUND
           INC    BX
           MOV    CL,5
           PUSH   BX
    ;填空⑦
           LEA    DI,CITYTAB[BX]
           POP    BX
    ;填空⑧
           JL     SRCH

    FOUND: 
           MOV    CITYOUT+6,BL
    ;填空⑨
           MOV    SI,DI
           LEA    DI,CITYOUT+7
    ;填空⑩
           CLD
           REP    MOVSW
           LEA    DX,CITYOUT
           MOV    AH,09
           INT    21H

GETL ENDP                                      ;乙

NOW PROC NEAR
           PUSH   BP
           MOV    BP,SP                        ;丙
           PUSH   CX
           PUSH   AX
           PUSH   DX
           MOV    BX,[BP+4]
           CMP    BX,09
           JZ     RTN
           MOV    DX,[BP+6]                    ;△
           MOV    AL,DH
           ADD    AL,24H
           DAA
           ADD    AL,BL
           DAA
           SUB    AL,8
           CMP    AH,24H
           JL     OUTPUT

    OUTPUT:
           MOV    BH, AL
           MOV    BL, DL
           MOV    CH, 4
    ROTATE:
           MOV    CL, 4
           ROL    BX, CL
           MOV    AL, BL
           AND    AL, 0FH
           ADD    AL, 30H
           MOV    DL, AL
           MOV    AH, 2
           INT    21H
           DEC    CH
           PUSHF                               ;☆
           CMP    CH, 02
           JNZ    NO
           MOV    DL, 3AH
           MOV    AH, 02H
           INT    21H
    NO:    
           POPF                                ;☆
           JNZ    ROTATE
    RTN:   
           POP    DX
           POP    AX
           POP    CX
           POP    BP
           RET    4                            ;丁
NOW ENDP
CODE ENDS
END START
```

### 2023-1程序填空题

以上程序中子程序GETL实现接受一个城市名输入，然后在数据段定义的城市名字符串列表中进行搜索，如找到则输出相应完整字符串，并获得序列号。该子程序及相关部分程序中有十处空白，已用①到⑩标出。请将空白处填入适当的指令，每空2分，每空限填一条指令。

（不确定答案）
```asm
DATA SEGMENT
    MSG     DB 'WHICH CITY?',13,10,'$'
    CITYIN  DB 10,?,10 DUP (?)
    CITYOUT DB 13,'UMT+0',?,32 DUP (?),13,10,'$'
    CITYTAB DB 'LONDON, UNITED KINGDOM         '
            DB 'BERLIN, GERMANY                '
            DB 'ATHENS, GREECE                 '
            DB 'MOSCOW, RUSSIA                 '
            DB 'DUBAI, UNITED ARAB EMIRATES    '
            DB 'ISLAMABAD, PAKISTAN            '
            DB 'ALMATY, KAZAKHSTAN             '
            DB 'BANGKOK, THAILAND              '
            DB 'BEIJING, CHINA                 '
            DB 'I DO NOT KNOW :(               '
DATA ENDS

CODE SEGMENT
MAIN PROC FAR
           ASSUME CS:CODE, DS:DATA, ES:DATA
    START: PUSH   DS                           ;❀
           SUB    AX,AX
           PUSH   AX
           MOV    AX,DATA
           MOV    DS,AX
           mov    es,ax                        ;填空①，扩展段
           CALL   GETT                         ;甲
           PUSH   AX
           CALL   GETL
           pop    ax                           ;填空②
           CALL   NOW
           RET
MAIN ENDP

    ;ah=时，al=分
GETT PROC
           MOV    AL, 4                        ;看附录，时
           OUT    70H,AL
           IN     AL, 71H
           MOV    AH, AL
           MOV    AL, 2                        ;分？原来的附录错了
           OUT    70H, AL
           IN     AL, 71H
           RET
GETT ENDP

GETL PROC
           LEA    DX, MSG                      ;输出'WHICH CITY?'
           MOV    AH,09H
           INT    21H

           lea    dx,CITYIN                    ;填空③,输入字符串
           MOV    AH,0AH
           INT    21H
    
           MOV    BX,0
           LEA    DI,CITYTAB

    SRCH:  
    ;这里开始比较了
           mov    cl,CITYIN[1]                 ;填空④，字符串长度
           cld                                 ;填空⑤，方向位
           SUB    CH,CH
           PUSH   DI
           REPE   CMPSB                        ;比较是否相等
           pop    di                           ;填空⑥
           JE     FOUND
           INC    BX
           MOV    CL,5
           PUSH   BX
    ;填空⑦,不会
           LEA    DI,CITYTAB[BX]
           POP    BX
           cmp    bx,10                        ;填空⑧
           JL     SRCH

    FOUND: 
           MOV    CITYOUT+6,BL
           pop    di                           ;填空⑨
           MOV    SI,DI
           LEA    DI,CITYOUT+7
           mov    cx, 16                       ;填空⑩
           CLD
           REP    MOVSW
           LEA    DX,CITYOUT
           MOV    AH,09
           INT    21H

GETL ENDP                                      ;乙

NOW PROC NEAR
           PUSH   BP
           MOV    BP,SP                        ;丙
           PUSH   CX
           PUSH   AX
           PUSH   DX
           MOV    BX,[BP+4]
           CMP    BX,09
           JZ     RTN
           MOV    DX,[BP+6]                    ;△
           MOV    AL,DH
           ADD    AL,24H
           DAA
           ADD    AL,BL
           DAA
           SUB    AL,8
           CMP    AH,24H
           JL     OUTPUT

    OUTPUT:
           MOV    BH, AL
           MOV    BL, DL
           MOV    CH, 4
    ROTATE:
           MOV    CL, 4
           ROL    BX, CL
           MOV    AL, BL
           AND    AL, 0FH
           ADD    AL, 30H
           MOV    DL, AL
           MOV    AH, 2
           INT    21H
           DEC    CH
           PUSHF                               ;☆
           CMP    CH, 02
           JNZ    NO
           MOV    DL, 3AH
           MOV    AH, 02H
           INT    21H
    NO:    
           POPF                                ;☆
           JNZ    ROTATE
    RTN:   
           POP    DX
           POP    AX
           POP    CX
           POP    BP
           RET    4                            ;丁
NOW ENDP
CODE ENDS
END START
```

### 2023-2读程序题

1.❀处的标号START作用是什么？（2分）
START是程序的入口标号，标志程序从这里开始执行，并作为程序入口点被汇编器用在 END START 指令中，指定程序从此处开始运行。

2.GETT子程序的主要功能是什么？（请参看附录2）（2分）
GETT 子程序的功能是从 CMOS 实时时钟读取当前的时间（小时和分钟）。其中，高字节 AH 保存当前小时，低字节 AL 保存当前分钟。

3.请描述出IP指向甲、乙、丙、丁等四处时，堆栈段的使用情况，包括堆栈指针和相应存储单元的内容。（6分）
~~（看不下去了）~~

|甲|
|-|
| |
| |
|0|
|(ds)|

sp=0FFFCh

4.△处的语句作用是什么？为什么此处要使用BP寄存器？（2分）
语句作用：
```MOV DX, [BP+6]```将堆栈中参数的值加载到寄存器 DX 中。
其中,```[BP+6]```表示从栈帧中的参数地址读取数据。
使用 BP 的原因：
由于子程序执行时，SP 的值会随着入栈、出栈操作不断变化，而 BP 被固定用于指向当前栈帧，便于访问传入的参数和局部变量。

5.☆处的两个语句作用是什么？如果去掉会有什么影响？（2分）
作用：
PUSHF和POPF用于保存和恢复标志寄存器FLAGS的状态。
这两个指令确保在循环左移ROL和条件判断JNZ时，标志寄存器的原始状态不受破坏。
去掉的影响：
如果没有PUSHF和POPF，标志寄存器的状态可能在子程序中被错误修改，导致循环条件或程序逻辑出错。

6.NOW子程序的主要功能是什么？（2分）
根据输入的时间信息和城市时区差异，计算并显示当前的城市时间（以 "HH:MM" 格式输出）。

7.丁处指令的功能是什么？（2分）
```RET 4```指令用于从子程序返回，同时清理调用时传入的 4 字节参数。调用者堆栈的指针自动调整，避免手动释放参数。

8.此程序的完整功能是什么?请简要描述,并用合适的自拟输入内容演示程序行后可能输出的典型结果(GETT子程序功能请参看附录)(2分)
程序功能：
该程序提示用户输入一个城市名称，查找对应城市的时区信息，根据当前时间（由 CMOS 提供）计算并显示城市的本地时间。如果输入的城市未找到，则输出默认消息 "I DO NOT KNOW :("。

典型结果：
输入：BEIJING
输出：UMT+8 BEIJING, CHINA 13:45

### 2023-3编程计算题

请编写程序段，实现运算（A*B+2024）/C+D*E，其中A、B、C、D、E均为有符号数字型变量名。程序必须考虑运算导致的字长改变（余数不计），并请说明你的最终运算结果字长。

### 2023-4编程循环题

请编写完整程序实现新同学插入原班级名单并显示的功能。设班级名单为N个单元的数组，每个单元有10个字节。其中第一个字节存放着学号，其余9个字节存放学生英文姓名。假定起始时名单中已有n个同学，学号已按照姓名字母为序升序排列，现再从键盘接收一个姓名的输入，并插入已有名单。

### 2023-5编程中断题

请完整程序采用接管1CH中断的方法实现在一小时倒计时的功能。程序开始时从59分59秒开始倒计时，每秒刷新一次时间。当计时回到00:00时重新从59:59开始倒计时。

### 2023附录

附录1：DOS系统功能调用（INT 21H）

| AH  | 功能             | 调用参数                                       | 返回参数                  |
| --- | ---------------- | ---------------------------------------------- | ------------------------- |
| 01  | 键盘输入并回显   |                                                | AL=输入的字符             |
| 02  | 显示输出         | DL=输出字符                                    |                           |
| 09  | 显示字符串       | DS：DX=串地址，串以'$'结束                     |                           |
| 0A  | 键盘输入到缓冲区 | DS：DX=缓冲区首址<br>(DS：DX)=缓冲区最大字符数 | (DS：DX)=实际输入的字符数 |
| 25  | 设置中断向量     | DS：DX=中断向量<br>AL=中断类型号               |                           |
| 35  | 取中断向量       | AL=中断类型号                                  | ES：BX=中断向量           |

1CH中断每秒钟约产生18次

附录2：CMOS RAM 中的时间信息

| 单元 | 存放内容 |
| ---- | -------- |
| 0    | 秒       |
| 2    | 分       |
| 4    | 时       |
| 7    | 日       |
| 8    | 月       |
| 9    | 年       |

这些数据以BCD码的方式存放。

从CMOS RAM 中读取信息的方式是：

```
OUT 70H, XX ; XX 为要访问的单元地址
IN AL, 71H   ; 从单元处读取数据
```
