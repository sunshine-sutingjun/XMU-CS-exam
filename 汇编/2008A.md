# 2008A期末试卷答案

[toc]

## 2008A-1读程序题

以下程序中有4处标记，请给出每处标记指令第一次执行前堆栈段的使用情况，并请说明该程序的主要功能和运行结果。

```asm
data    segment
num1    dw      0
num2    dw      0ffffh
num3    dw      5555h
data    ends
code1   segment
        assume  cs:code1,ds:data
max     macro   K , A , B , C
        local   next , out
        mov     bx , A
        IF      K-1
        IF      K-2
        cmp     c , bx
        JLE     next
        mov     bx , c
        endif
next:
        cmp     B , bx
        jle     out
        mov     bx , B
        endif
out:
        endm
main    proc    far
start:
        push    ds
        sub     ax , ax
        push    ax
        mov     ax , data
        mov     ds , ax

count = 0
        rept    3
count = count+1
        max     count , num1 , num2 , num3
        call    far ptr output                            ①
        endm
        ret
main    endp
code1   ends
code2   segment
        assume  cs:code2 , ds:data
output  proc    far
        mov     ch , 4                                ②
rotate:
        mov     cl , 4
        rol     bx , cl
        mov     al , bl
        and     al , 0fh
        add     al , 30h
        cmp     al , 3ah
        jl      printit
        add     al , 7h
printit:
        mov     dl , al
        mov     ah , 2
        int     21h
        dec     ch
        jnz     rotate
        call    crlf
        ret                                            ③
output  endp
crlf    proc    near
        mov     dl , 0dh                                ④
        mov     ah , 2
        int     21h
        mov     dl , 0ah
        mov     ah , 2
        int     21h
        ret
crlf    endp
code2   ends
        end     start
```

⑤请说明程序功能
⑥程序运行结果

1）
堆栈段使用情况

<1>
|     |
| --- |
|     |
| 0   |
| ds  |
|     |

sp=0fffch

<2>
|     |
| --- |
|     |
| IP  |
| CS  |
| 0   |
| ds  |
|     |

sp=0fff9h

<3>
|     |
| --- |
|     |
| IP  |
| CS  |
| 0   |
| ds  |
|     |


<4>
|     |
| --- |
|     |
| IP  |
| IP  |
| CS  |
| 0   |
| ds  |
|     |

2）
程序功能

输出三个数最大的

3）运行结果

5555

## 2008A-2填空题

以下程序实现接收单个字符输入，统计数据段中已有4个字符串中包含有输入字符的串的个数并显示出来。程序中有10处空白，请填上相应的指令，使程序完整。每空限填一条指令。并请写出程序运行的结果。

题目代码：

```asm
data    segment
str1    db 'Happy   '
str2    db 'Love    '
str3    db 'Marriage'
str4    db 'Hate    '
data    ends
code    segment
        assume cs:code , ds:data
main    proc    far
start:
        push    ds
        sub     ax , ax
        push    ax
        mov     ax , data
        mov     ds , ax
                ①       

                ②       
        int     21h
        mov     bx , 0
        mov     dl , 0
search:
                ③       
        push    bx
        shl     bx , cl
                ④       
                ⑤       
        cld
        ⑥       
        jne     next
        inc     dl
next:
                ⑦       
        inc     bx
        cmp     bx , 4
        jnz     search

                ⑧       
        ⑨       
        int     21h
        ret
main    endp
code    ends
        ⑩      
```

```asm
mov es,ax
mov ah,01h
mov cl,3
lea di,str1[bx]
mov cx,8
repne scasb
pop bx
mov ah,02h
add dl,30h
end start
```

```asm
data segment
    str1 db 'happy   '
    str2 db 'Love    '
    str3 db 'Marriage'
    str4 db 'hate    '
data ends
code segment
assume cs:code,ds:data,es:data
main proc far
start:
    push ds
    sub ax,ax
    push ax
    mov ax,data
    mov ds,ax
    mov es,ax
    mov ah,01h
    int 21h
    mov bx,0
    mov dl,0
search:
    mov cl,3
    push bx
    shl bx,cl
    lea di,str1[bx]
    mov cx,8
    cld
    repne scasb
    jne next
    inc dl
next:
    pop bx
    inc bx
    cmp bx,4
    jnz search
    mov ah,02h
    add dl,30h
    int 21h
    ret
main endp
code ends
end main
```

答案：

```asm
mov es,ax      ;1
mov ah,1       ;2
mov cl,3       ;3,和shl bx,cl配合,相当于bx*=8,得到字符在数据段开始的位置
mov cx,8       ;4
lea di,str1[bx];5
repne scasb    ;6,查找al对应的字符是否在di里
pop bx         ;7
add al,30h     ;8
mov ah,2       ;9
end start      ;10
```

## 2008A-3编程计算题

数据段中定义了4个<mark>带符号字</mark>数据：A、B、C、D，编写指令计算出A+（B*10+C）/D的结果，并说明结果的存放情况。

```asm
datarea segment
        a       dw 100
        b       dw 200
        cc      dw 300        ;在真实的汇编编程中，c是一个关键字，会报错。但是考试还得写成“C”
        d       dw 23
datarea ends
prognam segment
main proc far
                assume cs:prognam,ds:datarea
        start:  
                push   ds
                sub    ax,ax
                push   ax
                mov    ax,datarea
                mov    ds,ax
            
        ;A+(B*10+C)/D
        ;考试从这儿开始写
                mov    ax,b
                mov    bx,10
                imul   bx
                mov    cx,dx
                mov    bx,ax
                mov    ax,cc
                cwd
                add    ax,bx
                adc    dx,cx
                idiv   d
                add    ax,a
        ;考试从这儿结束
                ret
main endp
prognam ends
    end start
```

结果存在ax中

## 2008A-4编程循环题

已知数组A包含15个互不相等的整数，数组B包含20个互不相等的整数。试编制一程序，统计既在A中出现又在B中出现的元素的个数，并以10进制显示出来。

```asm
;稳妥版
datarea segment
    a       db 3, 6, 9, 12, 15, 18, 21, 24, 27, 30, 33, 36, 39, 42, 45
    b       db 2, 4, 6, 8, 10, 12, 14, 16, 18, 20, 22, 24, 26, 28, 30, 32, 34, 36, 38, 40
    a_count db 15
    b_count db 20
    ;res:[6, 12, 18, 24, 30, 36]
datarea ends
prognam segment
main proc far
              assume cs:prognam,ds:datarea
    start:    
              push   ds
              sub    ax,ax
              push   ax
              mov    ax,datarea
              mov    ds,ax
            
              mov    ax,0                     ;count of same numbers
              mov    si,0                     ;a[si]
    loop1:    
              mov    di,0
    loop2:    
              mov    bl,a[si]
              cmp    bl,b[di]
              jne    not_equal
              inc    ax
    not_equal:
              inc    di
              cmp    di,20
              jl     loop2
              inc    si
              cmp    si,15
              jl     loop1
              call   bin2dec
              ret
main endp
bin2dec proc
    ;ax/src=al...ah
              mov    cx,0
    loop3:    
              mov    bl,10
              div    bl
              push   ax
              xor    ah,ah
              inc    cx
              cmp    al,0
              jg     loop3
    putchar:  
              pop    dx
              mov    dl,dh
              add    dl,30h
              mov    ah,2
              int    21h
              loop   putchar
              ret
bin2dec endp
prognam ends
end start
```

## 2008A-5编程中断题

编写程序通过接管1CH中断的方式实现每隔1秒钟读取一次打印机状态寄存器（端口号397H）内容，如果最高位为0，显示“busy”（20分）

```
data segment
    count dw 1
    mes db 'busy',13,10,'$'
data ends
code segment
main proc far
assume cs:code, ds:data
start:
    push ds
    sub ax,ax
    push ax
    mov ax,data
    mov ds,ax
    mov es,ax

;保存旧的中断向量
    mov al,1c
    mov ah,35h
    int 21h
    push es
    push bx

    push ds 

    mov dx,offset check
    mov ax,seg check
    mov ds,ax
    mov al,1ch
    mov ah,25h
    int 21h

    pop ds
    ;打开定时器
    in al,21h
    and al,11111110b
    out 21h,al
    sti

    mov di,20000
delay:
    mov si,30000
delay1:
    dec si
    jnz delay1
    dec di 
    jnz delay
    ;重新设置回旧的中断向量
    cli
    pop dx
    pop ds
    mov al,1ch
    mov ah,25h
    int 21h

    ret
main endp
check proc near
    push ax
    push dx
    push ds

    mov ax,data
    mov ds,ax
    sti
    dec count 
    jnz exit

    mov dx,397h
    in al,dx
    test al,10000000b
    jnz exit2
    call output
exit2:
    mov count,18
exit:
    cli
    pop ds
    pop dx
    pop ax
    iret
check endp
output proc near
    lea dx,mes
    mov ah,09h
    int 21h
    ret
output endp
code ends
end start
```

## 三、A+(B*10+C)/D解答again

```
data segment
    a dw 100
    b dw 200
    numc dw 300
    d dw 23
data ends
code segment
main proc far
assume cs:code,ds:data
start:
    push ds
    sub ax,ax
    push ax
    mov ax,data
    mov ds,ax

    mov ax,b
    mov bx,10
    ;注意不能直接imul 10，会报错
    imul bx
    mov bx,ax
    mov cx,dx
    ;注意加数要先转移到ax中cwd
    mov ax,numc
    cwd
    add ax,bx
    adc dx,cx
    idiv d

    mov bx,ax
    mov cx,dx
    
    mov ax,a
    cwd
    add ax,bx
    adc cx,dx

    ret
main endp
code ends
end start
```
结果存放在dx,ax中

## 四、解答again

```
data segment
    a dw 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15
    b dw 20, 18, 16, 14, 12, 10, 8, 6, 4, 2, 0, 21, 23, 25, 27, 29, 31, 33, 34,
35

data ends
code segment
main proc far
assume cs:code,ds:data,es:data
start:
    push ds
    sub ax,ax
    push ax
    mov ax,data
    mov ds,ax
    mov es,ax

    lea si,a
    mov cx,15
outloop:
    lea di,b
    
    push cx
    mov cx,20
innerloop:
    mov bx,[si]
    cmp bx,[di]
    jnz next
    call output
next:
    add di,2
    loop innerloop
    pop cx
    add si,2
    loop outloop
    ret
main endp
output proc near
    mov cx,10d
    call divbx
    mov cx,1d
    call divbx
    call crlf
    ret
output endp
divbx proc near
    mov ax,bx
    mov dx,0
    div cx
    mov bx,dx
    mov dl,al
    add dl,30h
    mov ah,02h
    int 21h
    ret
divbx endp
crlf proc near
    mov dl,0ah
    mov ah,02h
    int 21h
    mov dl,0dh
    mov ah,02h
    int 21h
    ret
crlf endp
code ends
end start
```
