
操作系统实验考试 2017.6.12



在目录“/home/cs14/exam”下有本文件，可复制到你自己的主目录后，

用“cat testpaper”命令打开查看，或下载testpaper.txt到本地打开查看。该目录还有

程序文件“threadtest.cc”，“mybound.h”和“mybound.cc”。

另有原生nachos代码压缩包备用。


程序 mybound.cc 实现一个有限缓存区的生产者消费者模型，描述如下：

1、 有限缓冲区是用mybound.cc中所声明的整型数组 buf 所实现。

2、 函数Fill()把数组src中的整数依次填充到容量有限的buf里去，填充仅当buf为空时
    
    启动，buf充满则暂停等待下次启动，当src中的每个整数均被用来填充一次后，
    
    填充结束。在填充数据的过程中，它进行上下文切换，使得其他线程可以并发地运行。

3、 每当填充暂停或结束，缓冲区buf的所有奇数首先被函数RemoveOdd()清除，然后函数

    RemoveEven()负责清除剩余的偶数。RemoveEven仅在RemoveOdd执行完成且缓冲区buf

    不为空时被启动。两个函数在清除过程中，均可能发生上下文切换，使得其他线程

    可以并发地运行。

4、 函数CheckEmpty()检查buf是否为空，若为空，则唤醒Fill继续进行填充。检查过程中

    可能发生上下文切换，使得其他线程可以并发地运行。该检查操作不断重复，直到

    程序运行结束。

5、 文件threadtest.cc中的函数ThreadTest()负责为函数 RemoveOdd，RemoveEven 和

    CheckEmpty 各创建一个线程执行，自己负责执行 Fill 函数。考试时应将nachos原有

    的同名文件替换为此文件。


问题：

    代码文件mybound.cc中缺少若干语句，因此程序无法运行。本次考试的内容是，

    向该代码文件中填加适当语句，并将其编译到nachos项目中，使程序按上述规则

    正确执行直到结束。


要求：

1、 修改代码时只能在英文注释指定的位置添加语句，不能删除或注释掉现有的语句，

    不允许增加新的函数。

2、 在你的起始目录下创建目录“osexam”(不含引号，全部小写)。将结果，

    即nachos-3.4子目录code下的文件Makefile.common，及其子目录threads下的文件

    Makefile，mybound.cc和nachos，以及其他被修改的文件，拷贝至目录osexam中。

    目录osexam中不要包含除了上述文件外的其他文件和目录。

3、 开卷考试，但是不能互相讨论、抄袭，绝对禁止使用手机以及即时通讯工具。



请严格按上述要求完成考试，否则将没有实验成绩。



建议：为了避免以前实验代码的干扰，可以重新安装一个新的Nachos系统，并在此系统内

调试程序。为了防止新系统覆盖原来的实验代码，可先将原系统的目录更名或备份于其他

目录。

